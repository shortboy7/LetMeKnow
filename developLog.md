# 개발기록
## 2022-06-26 이전
오늘부터 코딩만 하는게 아니라 기록도 남겨두기로 했습니다.

지난 일을 돌아보면 뭐 처음 만들어보는 웹 크롤링 어플리케이션이라 
request, cheerio 모듈 사용법을 익히고, request 모듈(depreciated)에서 axios 모듈로 바꿨는데 분명 콘솔에 잘 찍혀야 할 것이 계속 깨져서 나오길래 

가져올 때 인코딩 문제인 줄 알고 iconv 등등 해서 뻘 짓을 했는데 알고보니 잘 가져왔는데 cmder가 한글 출력이 안되는 거 였음... fs 모듈로 파일로 저장하니 잘 됨..

그렇게 간신히 node.js에서 처리를 끝내고 renderer 프로세서로 읽어온 데이터를 보내야 하는데, 메인 => 렌더러 방향으로 통신하는 

방법을 찾는데 좀 걸리고, 이걸 app.whenReady안에 콜백함수로 넣어서 안되다가 app.on('ready', callback) 여기 자리에 넣으니 잘 됨. 하도 오래된 기술이다보니 (2019년 부터 존재...)

참고하는 자료가 현재 버젼과 호환이 안되는 자료였었나 봄. 이렇게 렌더러 프로세스에 전달하는 것까지 끝.

이제 양이 많은 게시물 자료들을 한 화면에 담기 위해 pagination 을 구현해야 했는데 이거는 codepen에서 가져와서 손쉽게 구현함. 그런데 이 과정에서 renderer 프로세스에 대해서 좀 더 공부하고 main 프로세스랑 사용할 수 있는 모듈이 차이가 난다고 배웠음.

이제 찾은 게시물들의 제목을 클릭하면 실제로 그 게시물을 보이도록 하고 싶었는데 webview라는 eletrcon 제공 태그를 사용할까 생각하다가 아예 새로운 창을 만드는게 나은 것 같아서 이것저것 해보다가 loadUrl로 새 창을 만드는 방법을 결정함. 메인 프로세서와 독립적으로 작동하기 떄문에 url만 신경쓰면 그뒤로는 신경을 안써도 돼서 좋음.

이 url을 만들기 위해서 학교 웹사이트에서 보여주는 detail ID를 읽어와서 urlbase에 정해진 순서대로 조합해서 만들었음. 사이트마다 다를텐데 다른 사이트를 추가할 때마다 읽는 방식을 새롭게 정의해야돼서 번거로울 거라고 생각했음.

이제 내가 정해둔 keyword를 기준으로 그 keyword가 포함되지 않은 필요없는 정보들은 안 보여주고 (가지고는 있음), 또 날짜가 이미 지난 글이면 보여주지 않는 기능을 추가했는데, date는 정확하게 파싱해오지 않아서 테스트만 하고 주석처리 해놓음.

 여기서 발생한 문제는 렌더러 프로세스에서는 날짜순으로 정렬을 하고, 메인에서는 keyword필터링된 데이터를 가지고 있었기 떄문에 기존의 방식대로 렌더러 프로세서에서 가지고 있는 idx를 main에 보내서 그 idx에 있는 detailURL를 불러오는 방식으로는 그 제목에 맞는 글을 제대로 불러오지 못해서 
 
 아예 메인에서 모든 작업을 끝내고 최종결과를 들고 있고, 이걸 렌더러 프로세스에 보내고 렌더러 프로세스는 받기만 해서 서로의 idx를 일치시켜서 해결햇음. 사실 간단한 건데, electron 및 nodejs 에 익숙하지 못하고, 모듈간에 역할 분담을 잘못이해해서 뻘짓을 한 듯

## 2022-06-26
이렇게 하다보니 main.js에 코드가 과다하게 몰려있어서 웹페이지를 읽어오는 부분을 따른 파일에 옮길려고 하다보니 전역변수로 대충 써놨던 변수들이 많이 걸리적 거렸다. 비동기 처리를 잘 못해서 대충 await async로 어떻게든 만들어 놨던 부분들이 발목을 크게 잡았음. 

어디서 부터 어디까지 이 모듈에게 할일을 부여할지 몰라서 결국은 만들어지는대로 역할을 부여했음.... 지금은 HTML파일에서 원하는 정보들까지 뽑아오는 것 까지 했는데, 더 세분화할 필요가 있어보임 제일 고생했던 부분은 비동기 콜백함수들이 모두 완료될 때 까지 기다렸다가 함수를 끝내고 싶었는데 setTimeout이 promise를 반환하는 걸로 착각해 이 리턴값을 setTimePromises 배열에 저장해서 Promise.allSettled + then + 각 페이지 읽어오는 콜백함수 => promises 배열에 등록 => Promises.allSettled(promises) 이런식으로 하다가 

timeout 반환값이 promise가 아니란걸 깨닫고 제일 나중에 콜백함수가 task queue에 들어간 시간보다 더 늦게 기다렸다가 모든 콜백함수가 끝나길 기다렸다가 결과를 반환하도록 했는데, 또 문제가 그 반환하는 .then()부분은 제대로 실행되는데, 반환되고 난 다음 then은 실행이 안돼서 async await을 이곳저곳 달아보고, 콘솔도 찍어보고 한참을 하다가 

설마하는 느낌으로 then 자체가 실행이 안된다고 stackoverflow에 검색해보니 내가 promise객체를 만들때 첫번째 인자로 들어오는 reselove 함수를 호출하지 않아서 실행을 했어도 해당 promise객체의 상태가 이행된 상태로 바뀌지 않아서 then이 실행이 안된 것이였다... 

내 4시간 ㅠㅠㅠㅠ 애초에 promise async await 등등에 대한 이해가 없이 막 썼던 나를 발전시킬 수 있었던 경험이여서 그렇게 나쁜 경험은 아니였다.

이제 테서렉트.js 를 이용해서 게시글 본문에 있는 이미지를 분석해서 구체적인 날짜를 알아볼 수 있게 만들 계획인데 이것도 사이트마다 게시글을 보여주는 방식이 다르고 id명이 다를테니 새롭게 정의해야되는 부분이다보니 학교홈페이지는 하겠는데 나머지를 만들기가 정말 힘들겠다는 생각을 했다... 형식을 만들어서 그 형식만 채우면 자동으로 분석되게 만드는 방법도 나쁘지 않지 않겠다고 생각해봤는데 우선 학교 홈페이지에서 부터 시작해봐야겠다.

